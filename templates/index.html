<script>
  async function fetchEvent() {
    try {
      const res = await fetch('/events');
      const data = await res.json();
      if (data.length > 0) {
        const e = data[0];
        let msg = '';
        if (e.type === 'push') {
          msg = `"${e.author}" pushed to "${e.to_branch}" on ${e.timestamp}`;
        } else if (e.type === 'pull_request') {
          msg = `"${e.author}" submitted a pull request from "${e.from_branch}" to "${e.to_branch}" on ${e.timestamp}`;
        } else if (e.type === 'merge') {
          msg = `"${e.author}" merged branch "${e.from_branch}" to "${e.to_branch}" on ${e.timestamp}`;
        }
        document.getElementById('event').innerText = msg;
      } else {
        document.getElementById('event').innerText = "No events yet.";
      }
    } catch (err) {
      document.getElementById('event').innerText = "Error loading event.";
      console.error(err);
    }
  }

  fetchEvent();
  setInterval(fetchEvent, 15000);
</script>

